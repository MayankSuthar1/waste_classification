<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waste Classification - SqueezeNet + XGBoost</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            /* Dark theme (default) */
            --bg-primary: #0a0a0a;
            --bg-secondary: #141414;
            --bg-tertiary: #1a1a1a;
            --border-color: #222;
            --border-hover: #333;
            --text-primary: #ffffff;
            --text-secondary: #e5e5e5;
            --text-tertiary: #888;
            --text-muted: #666;
            --button-bg: #ffffff;
            --button-text: #000000;
            --button-hover: #e5e5e5;
            --error-bg: #1a0a0a;
            --error-text: #ff8888;
            --error-border: #2a1111;
        }
        
        body.light-mode {
            /* Light theme */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f8f8;
            --bg-tertiary: #f0f0f0;
            --border-color: #e0e0e0;
            --border-hover: #ccc;
            --text-primary: #000000;
            --text-secondary: #1a1a1a;
            --text-tertiary: #666;
            --text-muted: #999;
            --button-bg: #000000;
            --button-text: #ffffff;
            --button-hover: #333;
            --error-bg: #fff0f0;
            --error-text: #cc0000;
            --error-border: #ffcccc;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-secondary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 50px;
        }
        
        header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 300;
            letter-spacing: -0.5px;
        }
        
        header p {
            font-size: 1em;
            color: var(--text-tertiary);
            font-weight: 300;
        }
        
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 16px;
            cursor: pointer;
            font-size: 0.9em;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 300;
        }
        
        .theme-toggle:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-hover);
        }
        
        .card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 48px;
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            border-color: var(--border-hover);
        }
        
        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 60px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-primary);
        }
        
        .upload-area:hover {
            border-color: var(--border-hover);
            background: var(--bg-tertiary);
        }
        
        .upload-area.dragover {
            border-color: var(--text-muted);
            background: var(--bg-secondary);
        }
        
        .upload-icon {
            font-size: 3em;
            color: var(--text-muted);
            margin-bottom: 16px;
        }
        
        .upload-text {
            font-size: 1.1em;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-weight: 400;
        }
        
        .upload-hint {
            color: var(--text-muted);
            font-size: 0.85em;
            font-weight: 300;
        }
        
        #fileInput {
            display: none;
        }
        
        .button {
            background: var(--button-bg);
            color: var(--button-text);
            border: none;
            padding: 14px 32px;
            font-size: 0.95em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 400;
        }
        
        .button:hover {
            background: var(--button-hover);
            transform: translateY(-1px);
        }
        
        .button:disabled {
            background: var(--bg-tertiary);
            color: var(--text-muted);
            cursor: not-allowed;
            transform: none;
        }
        
        #imagePreview {
            display: none;
            margin: 30px 0;
            text-align: center;
        }
        
        #previewImage {
            max-width: 100%;
            max-height: 400px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        #results {
            display: none;
            margin-top: 30px;
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 32px;
        }
        
        .result-header h2 {
            color: var(--text-primary);
            font-weight: 300;
            font-size: 1.5em;
        }
        
        /* Video element style */
        #video {
            border: 1px solid var(--border-color);
        }
        
        .predicted-class {
            font-size: 2em;
            color: var(--text-primary);
            font-weight: 300;
            margin: 10px 0;
            letter-spacing: -0.5px;
        }
        
        .confidence {
            font-size: 1.1em;
            color: var(--text-tertiary);
            font-weight: 300;
        }
        
        .confidence-bar {
            width: 100%;
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            overflow: hidden;
            margin: 24px 0;
        }
        
        .confidence-fill {
            height: 100%;
            background: var(--text-primary);
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .probabilities {
            margin-top: 48px;
        }
        
        .probabilities h3 {
            color: var(--text-primary);
            font-size: 1.1em;
            font-weight: 400;
            margin-bottom: 24px;
        }
        
        .probability-item {
            margin: 20px 0;
        }
        
        .probability-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 300;
            color: var(--text-tertiary);
            font-size: 0.9em;
        }
        
        .probability-bar {
            width: 100%;
            height: 2px;
            background: var(--border-color);
            border-radius: 1px;
            overflow: hidden;
        }
        
        .probability-fill {
            height: 100%;
            background: var(--text-muted);
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 40px 0;
            color: var(--text-tertiary);
            font-weight: 300;
        }
        
        .spinner {
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--text-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: var(--error-bg);
            color: var(--error-text);
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
            border: 1px solid var(--error-border);
            font-size: 0.9em;
            font-weight: 300;
        }
        
        .actions {
            text-align: center;
            margin-top: 30px;
        }
        
        .button-secondary {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            margin: 0 10px;
        }
        
        .button-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-hover);
        }
        
        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .button-camera {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .button-camera:hover {
            background: var(--bg-secondary);
            border-color: var(--border-hover);
        }
        
        #cameraModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .camera-container {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 32px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            position: relative;
            border: 1px solid var(--border-color);
        }
        
        .camera-container h2 {
            color: var(--text-primary);
            font-weight: 300;
            font-size: 1.3em;
        }
        
        #video {
            width: 100%;
            max-width: 640px;
            border-radius: 10px;
            background: #000;
        }
        
        #canvas {
            display: none;
        }
        
        .camera-label {
            color: var(--text-tertiary);
        }
        
        .camera-select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            font-size: 0.9em;
            background: var(--bg-primary);
            color: var(--text-secondary);
            font-weight: 300;
        }
        
        #cameraError {
            background: var(--error-bg);
            color: var(--error-text);
            border: 1px solid var(--error-border);
        }
        
        .camera-controls {
            margin-top: 20px;
            text-align: center;
        }
        
        .close-camera {
            position: absolute;
            top: 16px;
            right: 16px;
            background: var(--bg-tertiary);
            color: var(--text-tertiary);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            font-size: 1.3em;
            cursor: pointer;
            line-height: 1;
            transition: all 0.2s ease;
        }
        
        .close-camera:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        footer {
            text-align: center;
            color: var(--text-muted);
            margin-top: 60px;
            font-size: 0.85em;
            font-weight: 300;
        }
        
        footer a {
            color: var(--text-tertiary);
            text-decoration: none;
            margin: 0 12px;
            transition: color 0.2s ease;
        }
        
        footer a:hover {
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">
        <span id="themeIcon">â˜€</span>
        <span id="themeText">Light</span>
    </button>
    
    <div class="container">
        <header>
            <h1>Waste Classification</h1>
            <p>AI-Powered Waste Sorting using SqueezeNet & XGBoost</p>
        </header>
        
        <div class="card">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">â¬†</div>
                <div class="upload-text">Click to upload or drag and drop</div>
                <div class="upload-hint">Supported formats: JPG, PNG, BMP (Max 16MB)</div>
                <input type="file" id="fileInput" accept="image/*">
            </div>
            
            <div class="button-group">
                <button class="button button-camera" onclick="openCamera()">
                    Take Photo with Camera
                </button>
                <button class="button button-secondary" onclick="triggerMobileCamera()" style="display: none;" id="mobileCameraBtn">
                    Use Phone Camera
                </button>
            </div>
            <input type="file" id="mobileCameraInput" accept="image/*" capture="environment" style="display: none;">
            
            <div id="imagePreview">
                <img id="previewImage" src="" alt="Preview">
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyzing image...</p>
            </div>
            
            <div class="error" id="error"></div>
            
            <div id="results">
                <div class="result-header">
                    <h2>Classification Result</h2>
                    <div class="predicted-class" id="predictedClass"></div>
                    <div class="confidence" id="confidenceText"></div>
                </div>
                
                <div class="confidence-bar">
                    <div class="confidence-fill" id="confidenceFill"></div>
                </div>
                
                <div class="probabilities">
                    <h3>All Class Probabilities</h3>
                    <div id="probabilitiesList"></div>
                </div>
                
                <div class="actions">
                    <button class="button button-secondary" onclick="classifyAnother()">
                        Classify Another Image
                    </button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>
                <a href="/api/health">API Status</a>
            </p>
        </footer>
    </div>
    
    <!-- Camera Modal -->
    <div id="cameraModal">
        <div class="camera-container">
            <button class="close-camera" onclick="closeCamera()">Ã—</button>
            <h2 style="text-align: center; margin-bottom: 20px;">Capture Waste Image</h2>
            <div id="cameraError" style="display: none; padding: 12px; border-radius: 8px; margin-bottom: 12px; font-size: 0.85em; white-space: pre-line; font-weight: 300;"></div>
            <div id="cameraSelector" style="margin-bottom: 16px; text-align: center; display: none;">
                <label for="cameraSelect" style="margin-right: 12px; font-weight: 300; font-size: 0.9em;" class="camera-label">Select Camera:</label>
                <select id="cameraSelect" onchange="switchCamera()" class="camera-select">
                </select>
            </div>
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas"></canvas>
            <div class="camera-controls">
                <button class="button" onclick="capturePhoto()">Capture Photo</button>
                <button class="button button-secondary" onclick="closeCamera()">Cancel</button>
            </div>
        </div>
    </div>
    
    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const imagePreview = document.getElementById('imagePreview');
        const previewImage = document.getElementById('previewImage');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');
        const error = document.getElementById('error');
        
        // Click to upload
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        // File selection
        fileInput.addEventListener('change', (e) => {
            handleFile(e.target.files[0]);
        });
        
        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFile(e.dataTransfer.files[0]);
        });
        
        function handleFile(file) {
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                showError('Please select an image file');
                return;
            }
            
            // Show preview
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                imagePreview.style.display = 'block';
                uploadArea.style.display = 'none';
            };
            reader.readAsDataURL(file);
            
            // Upload and classify
            uploadAndClassify(file);
        }
        
        function uploadAndClassify(file) {
            // Hide previous results and errors
            results.style.display = 'none';
            error.style.display = 'none';
            loading.style.display = 'block';
            
            // Create form data
            const formData = new FormData();
            formData.append('file', file);
            
            // Send to server
            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                
                if (data.error) {
                    showError(data.error);
                } else {
                    displayResults(data);
                }
            })
            .catch(err => {
                loading.style.display = 'none';
                showError('An error occurred: ' + err.message);
            });
        }
        
        function displayResults(data) {
            // Display predicted class
            document.getElementById('predictedClass').textContent = 
                data.predicted_class.toUpperCase();
            
            // Display confidence
            const confidence = (data.confidence * 100).toFixed(2);
            document.getElementById('confidenceText').textContent = 
                `Confidence: ${confidence}%`;
            
            // Update confidence bar
            const confidenceFill = document.getElementById('confidenceFill');
            confidenceFill.style.width = confidence + '%';
            confidenceFill.textContent = confidence + '%';
            
            // Display all probabilities
            const probabilitiesList = document.getElementById('probabilitiesList');
            probabilitiesList.innerHTML = '';
            
            // Sort probabilities
            const sortedProbs = Object.entries(data.probabilities)
                .sort((a, b) => b[1] - a[1]);
            
            sortedProbs.forEach(([className, prob]) => {
                const percentage = (prob * 100).toFixed(2);
                const item = document.createElement('div');
                item.className = 'probability-item';
                item.innerHTML = `
                    <div class="probability-label">
                        <span>${className}</span>
                        <span>${percentage}%</span>
                    </div>
                    <div class="probability-bar">
                        <div class="probability-fill" style="width: ${percentage}%"></div>
                    </div>
                `;
                probabilitiesList.appendChild(item);
            });
            
            // Show results
            results.style.display = 'block';
        }
        
        function showError(message) {
            error.textContent = message;
            error.style.display = 'block';
        }
        
        function classifyAnother() {
            // Reset everything
            imagePreview.style.display = 'none';
            results.style.display = 'none';
            error.style.display = 'none';
            uploadArea.style.display = 'block';
            fileInput.value = '';
        }
        
        // Camera functionality
        let stream = null;
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const cameraModal = document.getElementById('cameraModal');
        
        async function openCamera() {
            try {
                // First, check if mediaDevices is supported
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('Camera API not supported in this browser');
                }
                
                // Try to request camera first - this may prompt for permission
                // which then allows enumerateDevices to show device labels
                let tempStream;
                try {
                    tempStream = await navigator.mediaDevices.getUserMedia({ video: true });
                    // Stop it immediately, we just needed permission
                    tempStream.getTracks().forEach(track => track.stop());
                } catch (permErr) {
                    console.log('Initial permission request:', permErr.message);
                }
                
                // Now try to get list of available devices
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                
                console.log('All devices:', devices);
                console.log('Video devices found:', videoDevices);
                
                if (videoDevices.length === 0) {
                    // No camera detected - offer alternative
                    showNoCameraDialog();
                    return;
                }
                
                console.log('Available cameras:', videoDevices.length);
                
                // Try multiple constraint configurations
                let constraints;
                
                // Try 1: Environment camera with flexible constraints
                try {
                    constraints = { 
                        video: { 
                            facingMode: { ideal: 'environment' },
                            width: { ideal: 1280, min: 640 },
                            height: { ideal: 720, min: 480 }
                        } 
                    };
                    stream = await navigator.mediaDevices.getUserMedia(constraints);
                } catch (e) {
                    console.log('Environment camera not available, trying user camera...');
                    
                    // Try 2: User (front) camera
                    try {
                        constraints = { 
                            video: { 
                                facingMode: { ideal: 'user' },
                                width: { ideal: 1280, min: 640 },
                                height: { ideal: 720, min: 480 }
                            } 
                        };
                        stream = await navigator.mediaDevices.getUserMedia(constraints);
                    } catch (e2) {
                        console.log('Specific camera not available, trying any camera...');
                        
                        // Try 3: Any available camera with basic constraints
                        try {
                            constraints = { 
                                video: {
                                    width: { ideal: 1280, min: 640 },
                                    height: { ideal: 720, min: 480 }
                                }
                            };
                            stream = await navigator.mediaDevices.getUserMedia(constraints);
                        } catch (e3) {
                            console.log('Trying simplest constraints...');
                            
                            // Try 4: Simplest possible - just request video
                            constraints = { video: true };
                            stream = await navigator.mediaDevices.getUserMedia(constraints);
                        }
                    }
                }
                
                // If we got here, we have a stream!
                video.srcObject = stream;
                cameraModal.style.display = 'flex';
                
                console.log('Camera opened successfully!');
                console.log('Stream settings:', stream.getVideoTracks()[0].getSettings());
                
                // Populate camera selector if multiple cameras available
                await populateCameraSelector();
                
            } catch (err) {
                console.error('Camera error:', err);
                let errorMessage = 'Unable to access camera: ' + err.message;
                
                // Provide specific guidance based on error
                if (err.name === 'NotFoundError' || err.message.includes('not found')) {
                    errorMessage += '\n\nTroubleshooting:\n';
                    errorMessage += 'â€¢ Make sure your camera is connected and not in use by another application\n';
                    errorMessage += 'â€¢ Try closing other apps that might be using the camera (Zoom, Teams, Skype)\n';
                    errorMessage += 'â€¢ Restart your browser and try again';
                } else if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                    errorMessage += '\n\nCamera permission denied. Please:\n';
                    errorMessage += 'â€¢ Click the camera icon in your browser address bar\n';
                    errorMessage += 'â€¢ Select "Always allow" for camera access\n';
                    errorMessage += 'â€¢ Refresh the page and try again';
                } else if (err.name === 'NotReadableError') {
                    errorMessage += '\n\nCamera is in use by another application.\n';
                    errorMessage += 'Please close other apps using the camera.';
                }
                
                showError(errorMessage);
            }
        }
        
        function closeCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            cameraModal.style.display = 'none';
            document.getElementById('cameraError').style.display = 'none';
            document.getElementById('cameraSelector').style.display = 'none';
        }
        
        // Populate camera selector with available devices
        async function populateCameraSelector() {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                
                if (videoDevices.length > 1) {
                    const selector = document.getElementById('cameraSelect');
                    selector.innerHTML = '';
                    
                    videoDevices.forEach((device, index) => {
                        const option = document.createElement('option');
                        option.value = device.deviceId;
                        option.text = device.label || `Camera ${index + 1}`;
                        selector.appendChild(option);
                    });
                    
                    document.getElementById('cameraSelector').style.display = 'block';
                    return videoDevices;
                }
            } catch (err) {
                console.error('Error enumerating devices:', err);
            }
            return [];
        }
        
        // Switch to a different camera
        async function switchCamera() {
            const deviceId = document.getElementById('cameraSelect').value;
            
            // Stop current stream
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            try {
                // Start new stream with selected device
                stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        deviceId: { exact: deviceId },
                        width: { ideal: 1280, min: 640 },
                        height: { ideal: 720, min: 480 }
                    }
                });
                
                video.srcObject = stream;
                console.log('Switched to camera:', deviceId);
            } catch (err) {
                console.error('Error switching camera:', err);
                showCameraError('Failed to switch camera: ' + err.message);
            }
        }
        
        function showCameraError(message) {
            const errorDiv = document.getElementById('cameraError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }
        
        function capturePhoto() {
            // Set canvas size to video size
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Draw video frame to canvas
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Convert canvas to blob
            canvas.toBlob((blob) => {
                if (blob) {
                    // Create a file from blob
                    const file = new File([blob], 'camera-capture.jpg', { type: 'image/jpeg' });
                    
                    // Close camera
                    closeCamera();
                    
                    // Show preview
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        previewImage.src = e.target.result;
                        imagePreview.style.display = 'block';
                        uploadArea.style.display = 'none';
                    };
                    reader.readAsDataURL(file);
                    
                    // Upload and classify
                    uploadAndClassify(file);
                }
            }, 'image/jpeg', 0.95);
        }
        
        // Mobile camera fallback (uses native camera app)
        const mobileCameraInput = document.getElementById('mobileCameraInput');
        
        function triggerMobileCamera() {
            mobileCameraInput.click();
        }
        
        mobileCameraInput.addEventListener('change', (e) => {
            if (e.target.files && e.target.files[0]) {
                handleFile(e.target.files[0]);
            }
        });
        
        // Show dialog when no camera is found
        function showNoCameraDialog() {
            const message = `No camera detected on your device.

Options:
1. Check if camera is connected and enabled
2. Close other apps using the camera (Zoom, Teams, etc.)
3. Restart your browser
4. Use "Click to upload" to select an existing photo

On Mobile:
â€¢ Use the "ðŸ“± Use Phone Camera" button below
â€¢ This opens your phone's native camera app

On Desktop:
â€¢ Make sure your webcam is connected
â€¢ Enable camera in Device Manager (Windows)
â€¢ Check System Preferences (Mac)`;
            
            alert(message);
            
            // Show mobile camera button as alternative
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            if (isMobile) {
                document.getElementById('mobileCameraBtn').style.display = 'inline-block';
            }
        }
        
        // Detect if mobile and show appropriate button
        window.addEventListener('load', () => {
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            if (isMobile) {
                // On mobile, show the mobile camera button
                document.getElementById('mobileCameraBtn').style.display = 'inline-block';
            }
        });
        
        // Close camera when clicking outside the modal
        cameraModal.addEventListener('click', (e) => {
            if (e.target === cameraModal) {
                closeCamera();
            }
        });
        
        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            body.classList.toggle('light-mode');
            
            if (body.classList.contains('light-mode')) {
                themeIcon.textContent = 'ðŸŒ™';
                themeText.textContent = 'Dark';
                localStorage.setItem('theme', 'light');
            } else {
                themeIcon.textContent = 'â˜€';
                themeText.textContent = 'Light';
                localStorage.setItem('theme', 'dark');
            }
        }
        
        // Load saved theme preference
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                themeIcon.textContent = 'ðŸŒ™';
                themeText.textContent = 'Dark';
            }
        });
    </script>
</body>
</html>
